{"version":3,"sources":["modules/postGIS_layers/services/geojson-service.ts"],"names":[],"mappings":";AACA,IAAO,YAAY,WAAW,6BAA6B,CAAC,CAAC;AAE7D,IAAI,EAAE,GAAG,YAAY,EAAE,CAAC;AAExB;IAAA;IA2GA,CAAC;IAzGG,iDAAiD;IAEjD,iDAAiD;IACjD,mBAAmB;IACnB,yBAAyB;IACzB,YAAY;IACZ,SAAS;IAET,yBAAyB;IACzB,gCAAgC;IAChC,qBAAqB;IACrB,iEAAiE;IACjE,gEAAgE;IAChE,6DAA6D;IAC7D,gBAAgB;IAChB,YAAY;IACZ,QAAQ;IAER,mDAAmD;IACnD,IAAI;IAEJ,wBAAG,GAAH,UAAI,KAAa;QACb,MAAM,CAAC,EAAE,CAAC,KAAK,CAAC,oaAWe,GAAG,KAAK,GAAG,kBAAkB,CAAC,CAAA;QAI7D,0FAA0F;IAC9F,CAAC;IAED,2BAAM,GAAN,UAAO,KAAa;QACpB,sDAAsD;QACtD,kBAAkB;QAClB,iBAAiB;QACjB,mCAAmC;QACnC,eAAe;QACf,eAAe;QACf,sCAAsC;QACtC,yBAAyB;QACzB,OAAO;QACH,OAAO,CAAC,GAAG,CAAC,YAAY,GAAG,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,CAAC,CAAA;QACjD,MAAM,CAAC,EAAE,CAAC,KAAK,CAAC,uBAAuB,GAAG,KAAK,GAAG,iHAG/C,CAAC,CAAA;IACR,CAAC;IAED,8BAAS,GAAT,UAAU,KAAa,EAAE,KAAa,EAAE,IAAY;QAChD,MAAM,CAAC,EAAE,CAAC,KAAK,CAAC,sBAAsB,GAAG,KAAK,GAAG,QAAQ,GAAG,KAAK,GAAG,IAAI,GAAG,IAAI,CAAC,CAAA;IACpF,CAAC;IAED,gCAAW,GAAX,UAAY,KAAa;QACrB,MAAM,CAAC,EAAE,CAAC,KAAK,CAAC,qBAAqB,GAAG,KAAK,CAAC,CAAA;IAClD,CAAC;IAED,mCAAc,GAAd,UAAe,KAAa,EAAE,QAAgB,EAAE,EAAU;QACtD,iEAAiE;QACjE,MAAM,CAAC,EAAE,CAAC,KAAK,CAAC,iBAAiB,GAAG,KAAK,GAAG,8CAA8C,GAAG,QAAQ,GAAG,sBAAsB,GAAG,EAAE,GAAG,IAAI,CAAC,CAAA;IAC/I,CAAC;IAqCL,iBAAC;AAAD,CA3GA,AA2GC,IAAA;AAED,iBAAS,UAAU,CAAC","file":"../../../../modules/postGIS_layers/services/geojson-service.js","sourcesContent":["import Sequelize = require('sequelize');\r\nimport dbConnection = require('../../../core/db-connection');\r\n\r\nvar db = dbConnection();\r\n\r\nclass SQLService {\r\n    \r\n    // getList(searchValue: string): Promise<any[]> {\r\n\r\n    //     var findOptions: Sequelize.FindOptions = {\r\n    //         order: [\r\n    //             'lastName'\r\n    //         ]\r\n    //     };\r\n\r\n    //     if (searchValue) {\r\n    //         findOptions.where = {\r\n    //             $or: [\r\n    //                 { firstName: { $iLike: `%${searchValue}%` } },\r\n    //                 { lastName: { $iLike: `%${searchValue}%` } },\r\n    //                 { email: { $iLike: `%${searchValue}%` } },\r\n    //             ]\r\n    //         }\r\n    //     }\r\n        \r\n    //     return UserModel.Model.findAll(findOptions);\r\n    // }\r\n\r\n    get(table: string): Promise<any> {\r\n        return db.query(`SELECT jsonb_build_object(\r\n            'type',     'FeatureCollection',\r\n            'features', jsonb_agg(feature)\r\n        )\r\n        FROM (\r\n          SELECT jsonb_build_object(\r\n            'type',       'Feature',\r\n            'id',         id,\r\n            'geometry',   ST_AsGeoJSON(geom)::jsonb,\r\n            'properties', to_jsonb(row) - 'geom'\r\n          ) AS feature\r\n          FROM (SELECT * FROM mycube.t` + table + `) row) features;`)\r\n            \r\n\r\n\r\n        //return db.query('SELECT * FROM $1', { bind: [table], type: sequelize.queryTypes.SELECT})\r\n    }\r\n\r\n    create(table: string): Promise<any> {\r\n    //     db.query(`CREATE SEQUENCE public.\"test3_ID_seq\"\r\n    //     INCREMENT 1\r\n    //     MINVALUE 1\r\n    //     MAXVALUE 9223372036854775807\r\n    //     START 38\r\n    //     CACHE 1;\r\n    //   ALTER TABLE public.\"test3_ID_seq\"\r\n    //     OWNER TO geoadmin;\r\n    //   `)\r\n        console.log(\"API table=\" + JSON.stringify(table))\r\n        return db.query(`CREATE TABLE mycube.t` + table + ` (\r\n            ID    timestamp PRIMARY KEY DEFAULT current_timestamp,\r\n            geom   geometry\r\n        );`)\r\n    }\r\n\r\n    addColumn(table: string, field: string, type: string): Promise<any> {\r\n        return db.query('ALTER TABLE mycube.t' + table + ' ADD \"' + field + '\" ' + type)\r\n    }\r\n\r\n    deleteTable(table: string): Promise<any> {\r\n        return db.query('DROP TABLE mycube.t' + table)\r\n    }\r\n\r\n    updateGeometry(table: string, geometry: string, id: string): Promise<any> {\r\n        //return db.query(\"UPDATE mycube.t\" + table + ' SET \"1\" = true;')\r\n        return db.query(\"UPDATE mycube.t\" + table + \" SET geom = (ST_SetSRID(ST_GeomFromGeoJSON('\" + geometry + \"'),4326)) WHERE id='\" + id + \"';\")\r\n    }\r\n\r\n    \r\n//     create(request: App.User): Promise<UserModel.UserInstance> {\r\n//         //let plain_password = request.password\r\n//         //put the hash in here, then set request.password to hash result, have the code written in the js of this file\r\n//         //request.password = (Md5.hashStr(\"Monday01\")).toString()\r\n//         return UserModel.Model.create(request);\r\n//     }\r\n\r\n//     update(request: App.User): Promise<UserModel.UserInstance> {\r\n        \r\n//         return <any>(UserModel.Model.findById(request.ID).then((UserInstance) => {\r\n\r\n//             UserInstance.firstName = request.firstName;\r\n//             UserInstance.lastName = request.lastName;\r\n//             UserInstance.roleID = request.roleID;\r\n//             UserInstance.email = request.email;\r\n//             UserInstance.active = request.active;\r\n//             UserInstance.administrator = request.administrator;\r\n//             if (request.password) {\r\n//                 UserInstance.password = request.password;\r\n//             }\r\n\r\n//             return UserInstance.save();\r\n//         }));\r\n//     }\r\n\r\n//     delete(ID: number) {\r\n\r\n//         return UserModel.Model.findById(ID).then((UserInstance) => {\r\n\r\n//             return UserInstance.destroy();\r\n\r\n//         });\r\n//     }\r\n\r\n}\r\n\r\nexport = SQLService;"]}