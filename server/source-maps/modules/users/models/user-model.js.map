{"version":3,"sources":["modules/users/models/user-model.ts"],"names":[],"mappings":"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","file":"../../../../modules/users/models/user-model.js","sourcesContent":["import dbConnection = require('../../../core/db-connection');\r\nimport Sequelize = require('sequelize');\r\nimport GroupMemberModel = require('./group-member-model');\r\nimport DomainModel = require('../../domain/models/domain-model')\r\n\r\nvar db = dbConnection();\r\nvar bcrypt = require('bcrypt');\r\n\r\nexport interface UserInstance extends Sequelize.Instance<UserInstance, App.User>, App.User { }\r\nexport interface UserModel extends Sequelize.Model<UserInstance, App.User> { }\r\n\r\nconsole.log(\"IN USER MODEL\")\r\nvar sequalizeModel = db.define<UserInstance, App.User>('user', <any>{\r\n    ID: { type: Sequelize.INTEGER, primaryKey: true, autoIncrement: true },\r\n    firstName: {\r\n        type: Sequelize.STRING,\r\n        allowNull: false,\r\n        validate: {\r\n            len: [2, 30]\r\n        }\r\n    },\r\n    lastName: {\r\n        type: Sequelize.STRING,\r\n        allowNull: false,\r\n        validate: {\r\n            len: [2, 30]\r\n        }\r\n    },\r\n    password: {\r\n        type: Sequelize.STRING,\r\n        allowNull: false,\r\n        validate: {\r\n            len: [1, 200]\r\n        }\r\n    }, \r\n    active: {\r\n        type: Sequelize.BOOLEAN,\r\n        validate: {\r\n            is: [\"[a-z]\",'i'] //only allow letters //1/3/18 why is this here? letter validation for a boolean type?\r\n        }\r\n    },\r\n    email: { //consider adding isEmail: true when this is ready for deployment\r\n        type: Sequelize.STRING,\r\n        allowNull: false,\r\n        required: true,\r\n        unique: true,\r\n        validate: {\r\n            len: [1, 200],\r\n            isEmail: true\r\n        }\r\n    },\r\n    administrator: {\r\n        type: Sequelize.BOOLEAN,\r\n        validate: {\r\n            is: [\"[a-z]\",'i'] //1/3/18^^^\r\n        }\r\n    },\r\n    public: {\r\n        type: Sequelize.BOOLEAN,\r\n        validate: {\r\n            is: [\"[a-z]\",'i'] //1/3/18^^^\r\n        }\r\n    },\r\n    apikey: {\r\n        type: Sequelize.STRING,\r\n        allowNull: false,\r\n        validate: {\r\n            len: [2, 130]\r\n        }\r\n    },\r\n});\r\n\r\nsequalizeModel.belongsTo(DomainModel.Model)\r\nsequalizeModel.sync() \r\n\r\n//Should probably update this or at least put it in the documentation.\r\nsequalizeModel.findAll({\r\n}).then(function(result) {\r\n    if (!result[0]){\r\n    console.log(\"Creating standard user\")\r\n    var pw;\r\n    bcrypt.hash(\"admin\", 10, (err, hash) => {\r\n        pw = hash\r\n        sequalizeModel.create({\r\n            firstName: 'Generic',\r\n            lastName: 'Administrator',\r\n            password: pw,\r\n            active: false,\r\n            email: 'administrator@gmail.com',\r\n            administrator: true\r\n        })\r\n    })\r\n}\r\n});\r\n\r\nexport var Model = sequalizeModel;"]}