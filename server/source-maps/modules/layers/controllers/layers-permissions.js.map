{"version":3,"sources":["modules/layers/controllers/layers-permissions.ts"],"names":[],"mappings":"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","file":"../../../../modules/layers/controllers/layers-permissions.js","sourcesContent":["import LayerPermissionService = require('../services/layers-permission-service');\r\nimport GroupMemberService = require('../../users/services/group-member-service');\r\nimport token_auth = require('../../JWT_Checker/loginToken.js');\r\nimport { GroupMemberInstance } from '../../users/models/group-member-model';\r\nimport { LayerPermissionInstance } from '../models/layers-permission-model';\r\n\r\nexport class LayerPermissions {\r\n    constructor (public groupMemberService: GroupMemberService, public layerPermissionService: LayerPermissionService) {}\r\n    public finalResponse = new Array<any>();\r\n    public groups = new Array<number>();\r\n\r\n    public getPermissions(userID): Promise<any> {\r\n        let promise = new Promise((resolve, reject) => {\r\n            this.groupMemberService.getByUser(userID).then((result) => {\r\n                for (let i=0; i<result.length; i++) {\r\n                    let gg = new Array<number>()\r\n                    this.groups.push(result[i].groupID)\r\n                }\r\n                this.layerPermissionService.getByUserAndGroup(userID, this.groups).then((final) => {\r\n                    let lastLayerID: number\r\n                    final.sort((leftside, rightside): number => {\r\n                        if (leftside.layerID < rightside.layerID) return -1\r\n                        if (leftside.layerID > rightside.layerID) return 1\r\n                        return 0\r\n                    })\r\n                    let finalToSend: LayerPermissionInstance[] = []\r\n                    for (let j=0; j<final.length; j++) {\r\n                        //console.log(final[j].layerID)\r\n                        if (final[j].layerID != lastLayerID) {\r\n                            lastLayerID = final[j].layerID\r\n                            finalToSend.push(final[j])\r\n                        }\r\n                        else {\r\n                            if (final[j].canGrant == true) {\r\n                                finalToSend[finalToSend.length-1].canGrant = true\r\n                            }\r\n                            if (final[j].delete == true) {\r\n                                finalToSend[finalToSend.length-1].delete = true\r\n                            }\r\n                            if (final[j].edit == true) {\r\n                                finalToSend[finalToSend.length-1].edit = true\r\n                            }\r\n                        }\r\n                    }\r\n                    resolve(finalToSend)                    \r\n                })\r\n            })\r\n        })\r\n        return promise\r\n    }\r\n    \r\n}"]}