{"version":3,"sources":["modules/feature modules/services/module-permission-service.ts"],"names":[],"mappings":"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","file":"../../../../modules/feature modules/services/module-permission-service.js","sourcesContent":["import Sequelize = require('sequelize');\r\nimport ModulePermissionModel = require('../models/module-permission-model');\r\nimport ModuleInstance = require('../models/module-instances-model')\r\nimport UserModel = require('../../users/models/user-model')\r\nimport GroupModel = require('../../users/models/group-model')\r\nconst Op = Sequelize.or\r\n\r\n\r\nclass ModulePermissionService {\r\n    getList(): Promise<ModulePermissionModel.ModulePermissionInstance[]> {\r\n        return ModulePermissionModel.Model.findAll();\r\n    }\r\n    \r\n    getByInstance(instanceID: number): Promise<ModulePermissionModel.ModulePermissionInstance[]> {\r\n\r\n        var findOptions: Sequelize.FindOptions = {\r\n            order: [\r\n                'ID'\r\n            ]\r\n        };\r\n\r\n        if (instanceID) {\r\n            findOptions.where = {\r\n                $and: [\r\n                    { moduleInstanceID: instanceID}\r\n                ]\r\n            }\r\n        }\r\n\r\n        findOptions.include = [ModuleInstance.Model, UserModel.Model, GroupModel.Model];\r\n        return ModulePermissionModel.Model.findAll(findOptions);\r\n    }\r\n\r\n    getByUser(userID: number): Promise<ModulePermissionModel.ModulePermissionInstance[]> {\r\n\r\n        var findOptions: Sequelize.FindOptions = {\r\n            order: [\r\n                'ID'\r\n            ]\r\n        };\r\n\r\n        if (userID) {\r\n            findOptions.where = {\r\n                $and: [\r\n                    { userID: userID}\r\n                ]\r\n            }\r\n        }\r\n\r\n        findOptions.include = [ModuleInstance.Model, UserModel.Model, GroupModel.Model];\r\n        return ModulePermissionModel.Model.findAll(findOptions);\r\n    }\r\n\r\n    getByGroup(groupID: number): Promise<ModulePermissionModel.ModulePermissionInstance[]> {\r\n        console.log(groupID)\r\n        var findOptions: Sequelize.FindOptions = {\r\n            order: [\r\n                'ID'\r\n            ]\r\n        };\r\n\r\n        if (groupID) {\r\n            findOptions.where = {\r\n                $and: [\r\n                    { groupID: groupID}\r\n                ]\r\n            }\r\n        }\r\n\r\n        findOptions.include = [ModuleInstance.Model, UserModel.Model, GroupModel.Model];\r\n        return ModulePermissionModel.Model.findAll(findOptions);\r\n    }\r\n\r\n    getByUserAndGroup(userID: number, groups:number[]): Promise<ModulePermissionModel.ModulePermissionInstance[]> {\r\n        const op = Sequelize.or\r\n        var findOptions: Sequelize.FindOptions = {\r\n            order: [\r\n                'ID'\r\n            ]\r\n        }\r\n\r\n        if (userID) {\r\n            findOptions.where = {\r\n                $or: [\r\n                {groupID: {$or:[groups]}},\r\n                {userID: userID}\r\n        ]}\r\n        }\r\n\r\n        findOptions.include = [ModuleInstance.Model, UserModel.Model, GroupModel.Model];\r\n        return ModulePermissionModel.Model.findAll(findOptions)\r\n    }\r\n\r\n    get(ID: number): Promise<ModulePermissionModel.ModulePermissionInstance> {\r\n        return ModulePermissionModel.Model.findById(ID);\r\n    }\r\n\r\n    create(request: App.ModulePermission): Promise<ModulePermissionModel.ModulePermissionInstance> {\r\n        return ModulePermissionModel.Model.create(request);\r\n    }\r\n\r\n    update(request: App.ModulePermission): Promise<ModulePermissionModel.ModulePermissionInstance> {\r\n        \r\n        return <any>(ModulePermissionModel.Model.findById(request.ID).then((ModulePermissionInstance) => {\r\n\r\n            ModulePermissionInstance.edit = request.edit;\r\n            ModulePermissionInstance.delete = request.delete;\r\n            ModulePermissionInstance.owner = request.owner;\r\n            ModulePermissionInstance.canGrant = request.canGrant;\r\n            ModulePermissionInstance.grantedBy = request.grantedBy;\r\n            ModulePermissionInstance.comments = request.comments;\r\n\r\n            return ModulePermissionInstance.save();\r\n        }));\r\n    }\r\n\r\n    delete(ID: number) {\r\n\r\n        return ModulePermissionModel.Model.findById(ID).then((ModulePermissionInstance) => {\r\n            return ModulePermissionInstance.destroy();\r\n\r\n        });\r\n    }\r\n\r\n}\r\n\r\nexport = ModulePermissionService;"]}